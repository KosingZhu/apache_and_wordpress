# HTTPS配置指南：使用https://www.localtest.com访问本地网站

## 已完成的配置

我已经为您配置了Apache服务器的HTTPS支持和虚拟主机设置：

1. 在 `httpd.conf` 中已启用：
   - SSL模块（LoadModule ssl_module modules/mod_ssl.so）
   - 虚拟主机配置（Include conf/extra/httpd-vhosts.conf）
   - SSL配置文件（Include conf/extra/httpd-ssl.conf）

2. 在 `httpd-vhosts.conf` 中已添加：
   - www.localtest.com 的HTTP虚拟主机（80端口）
   - www.localtest.com 的HTTPS虚拟主机（443端口）
   - 配置了HTTP到HTTPS的自动重定向
   - 配置了SSL证书路径和安全设置

3. 创建了 `create_ssl_cert.bat` 脚本，用于生成自签名SSL证书

## 还需要手动完成的步骤

### 步骤1：生成自签名SSL证书

1. 以管理员身份运行命令提示符：
   - 点击开始菜单，搜索"命令提示符"
   - 右键点击"命令提示符"图标，选择"以管理员身份运行"

2. 在命令提示符中，导航到Apache目录：
   ```
   cd c:\Apache24
   ```

3. 运行证书生成脚本：
   ```
   create_ssl_cert.bat
   ```

4. 等待脚本执行完成，它将在 `c:\Apache24\conf\ssl\` 目录下生成 `server.key` 和 `server.crt` 文件
4.1: 注意：conf\extra\httpd-vhosts.conf 和 conf/extra/httpd-ssl.conf文件中只能存在一个
<VirtualHost :443> </VirtualHost>虚拟即配置，也就是说证书文件所存放的目录只能在这两个文件中的其中一个文件
配置所在路径。否则配置会被覆盖，无法生效。
4.2: 如果希望使用www.localtest.com 和 localhost 进行访问时，<VirtualHost :443> </VirtualHost> 和
<VirtualHost :80> </VirtualHost>配置项中的 ServerAlias 应该配置为localhost.即
<VirtualHost :443> ServerAlias localhost </VirtualHost>
<VirtualHost :80> ServerAlias localhost </VirtualHost>

### 步骤2：修改Windows hosts文件

1. 以管理员身份打开记事本：
   - 点击开始菜单，搜索"记事本"
   - 右键点击"记事本"图标，选择"以管理员身份运行"

2. 在记事本中，点击"文件" > "打开"

3. 导航到 `C:\Windows\System32\drivers\etc\` 目录

4. 在文件类型下拉菜单中选择"所有文件 (*.*)"

5. 选择"hosts"文件并点击"打开"

6. 在文件末尾添加以下行：
   ```
   127.0.0.1 www.localtest.com
   127.0.0.1 localtest.com
   127.0.0.1 localhost
   ```

7. 点击"文件" > "保存"以保存更改

### 步骤3：启用mod_rewrite模块（用于HTTP到HTTPS的重定向）

1. 打开 `c:\Apache24\conf\httpd.conf` 文件

2. 找到以下行并取消注释（删除前面的#符号）：
   ```
   #LoadModule rewrite_module modules/mod_rewrite.so
   ```
   修改为：
   ```
   LoadModule rewrite_module modules/mod_rewrite.so
   ```

3. 保存文件

### 步骤4：重启Apache服务器

1. 使用ApacheMonitor重启服务器，或者
2. 在命令提示符中运行：
   ```
   net stop Apache2.4
   net start Apache2.4
   ```

### 步骤5：在浏览器中访问网站

1. 打开浏览器，访问 `https://www.localtest.com`

2. 由于使用的是自签名证书，浏览器会显示安全警告

3. 您需要手动信任此证书才能继续访问
   - Chrome：点击"高级" > "继续前往www.localtest.com（不安全）"
   - Firefox：点击"高级" > "添加例外" > "确认安全例外"
   - Edge：点击"详细信息" > "继续访问网页"

## 注意事项

- 自签名证书仅适用于本地测试环境，不应用于生产环境
- 生产环境中应使用由受信任的证书颁发机构（CA）签发的证书
- 如果遇到问题，可以检查Apache的错误日志（logs/error.log和logs/localtest.com-ssl-error.log）
- 若需要禁用HTTP到HTTPS的重定向，可以在httpd-vhosts.conf文件中注释掉Rewrite相关的三行代码